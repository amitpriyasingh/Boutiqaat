CREATE OR REPLACE VIEW sandbox.parent_child_sku_mapping AS
SELECT parent_child.child_sku, parent_child.parent_sku, sm.sku_name, sm.brand, sm.category1, sm.category2, sm.category3, sm.category4, ptype.purchase_type FROM (((SELECT cpe_child.sku AS child_sku, cpe_parent.sku AS parent_sku FROM ((magento.catalog_product_relation cpr LEFT JOIN magento.catalog_product_entity cpe_child ON ((cpe_child.row_id = cpr.child_id))) LEFT JOIN magento.catalog_product_entity cpe_parent ON ((cpe_parent.row_id = cpr.parent_id)))) parent_child LEFT JOIN (SELECT purchase_type.document_no, purchase_type.purchase_type, purchase_type.sku, purchase_type.rownum FROM (SELECT ph."no" AS document_no, ph.purchase_type, pl."no" AS sku, pg_catalog.row_number() OVER(  PARTITION BY pl."no") AS rownum FROM (nav.purchase_header ph JOIN nav.purchase_line pl ON (((pl.document_no)::text = (ph."no")::text)))) purchase_type WHERE (purchase_type.rownum = 1)) ptype ON (((ptype.sku)::text = (parent_child.child_sku)::text))) LEFT JOIN nav.nav_sku_master sm ON (((sm.sku)::text = (parent_child.child_sku)::text)))
WITH NO SCHEMA BINDING;