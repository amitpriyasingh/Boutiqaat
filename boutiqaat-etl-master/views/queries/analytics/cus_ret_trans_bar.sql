CREATE OR REPLACE VIEW analytics.cus_ret_trans_bar AS
SELECT count(DISTINCT customer_retention.phone_no) AS total_customer, sum(CASE WHEN (customer_retention.total_orders_till_date = 1) THEN 1 ELSE 0 END) AS customer_with_1_transactions, sum(CASE WHEN (customer_retention.total_orders_till_date = 2) THEN 1 ELSE 0 END) AS customer_with_2_transactions, sum(CASE WHEN (customer_retention.total_orders_till_date = 3) THEN 1 ELSE 0 END) AS customer_with_3_transactions, sum(CASE WHEN (customer_retention.total_orders_till_date = 4) THEN 1 ELSE 0 END) AS customer_with_4_transactions, sum(CASE WHEN (customer_retention.total_orders_till_date = 5) THEN 1 ELSE 0 END) AS customer_with_5_transactions, sum(CASE WHEN (customer_retention.total_orders_till_date > 5) THEN 1 ELSE 0 END) AS customer_with_more_than_5_transactions FROM analytics.customer_retention
WITH NO SCHEMA BINDING;