/usr/local/bin/mysql --host=$DWH_MYSQL_HOST --user=$DWH_MYSQL_USER --password=$DWH_MYSQL_PASSWD $DWH_MYSQL_DB -rs -e "select CONCAT(\"order_date\",',',\"order_number\",',',\"item_id\",',',\"status\",',',\"quantity\",',',\"payment_method\",',',\"payment_gateway\",',',\"order_category\",',',\"item_sale_price_kwd\",',',\"item_sale_price\",',',\"exchange_rate\",',',\"order_currency\",',',\"item_shipping_charge_kwd\",',',\"item_shipping_charge\",',',\"sku\",',',\"category1\",',',\"category2\",',',\"brand\",',',\"shipped_date\",',',\"delivery_date\",',',\"awbno\")row UNION  select CONCAT('\"',IFNULL(order_date,''),'\",\"',IFNULL(order_number,''),'\",\"',IFNULL(item_id,''),'\",\"',IFNULL(order_status,''),'\",',IFNULL(quantity,''),',\"',IFNULL(payment_method,''),'\",\"',IFNULL(payment_gateway,''),'\",\"',IFNULL(order_category,''),'\",',IFNULL(net_sale_price_kwd,''),',',IFNULL(net_sale_price,''),',',IFNULL(exchange_rate,''),',\"',IFNULL(order_currency,''),'\",',IFNULL(shipping_charge_kwd,''),',',IFNULL(shipping_charge,''),',\"',IFNULL(sku,''),'\",\"',IFNULL(REPLACE(category1,',',''),''),'\",\"',IFNULL(REPLACE(category2,',',''),''),'\",\"',IFNULL(REPLACE(brand,',',''),''),'\",\"',IFNULL(DATE(shipped_at),''),'\",\"',IFNULL(DATE(delivered_at),''),'\",\"',IFNULL(awbno,''),'\"') from (select * from aoi.order_details where order_date between '2019-03-01' and '2019-03-31' order by order_date, order_number) e group by item_id;" > /var/datadumps/finance/ofs_order_dump_201903.csv
/usr/local/bin/mysql --host=$DWH_MYSQL_HOST --user=$DWH_MYSQL_USER --password=$DWH_MYSQL_PASSWD $DWH_MYSQL_DB -rs -e "select CONCAT(\"order_date\",',',\"order_number\",',',\"item_id\",',',\"status\",',',\"quantity\",',',\"payment_method\",',',\"payment_gateway\",',',\"order_category\",',',\"item_sale_price_kwd\",',',\"item_sale_price\",',',\"exchange_rate\",',',\"order_currency\",',',\"item_shipping_charge_kwd\",',',\"item_shipping_charge\",',',\"sku\",',',\"category1\",',',\"category2\",',',\"brand\",',',\"shipped_date\",',',\"delivery_date\",',',\"awbno\")row UNION  select CONCAT('\"',IFNULL(order_date,''),'\",\"',IFNULL(order_number,''),'\",\"',IFNULL(item_id,''),'\",\"',IFNULL(order_status,''),'\",',IFNULL(quantity,''),',\"',IFNULL(payment_method,''),'\",\"',IFNULL(payment_gateway,''),'\",\"',IFNULL(order_category,''),'\",',IFNULL(net_sale_price_kwd,''),',',IFNULL(net_sale_price,''),',',IFNULL(exchange_rate,''),',\"',IFNULL(order_currency,''),'\",',IFNULL(shipping_charge_kwd,''),',',IFNULL(shipping_charge,''),',\"',IFNULL(sku,''),'\",\"',IFNULL(REPLACE(category1,',',''),''),'\",\"',IFNULL(REPLACE(category2,',',''),''),'\",\"',IFNULL(REPLACE(brand,',',''),''),'\",\"',IFNULL(DATE(shipped_at),''),'\",\"',IFNULL(DATE(delivered_at),''),'\",\"',IFNULL(awbno,''),'\"') from (select * from aoi.order_details where order_date between '2019-04-01' and '2019-04-30' order by order_date, order_number) e group by item_id;" > /var/datadumps/finance/ofs_order_dump_201904.csv
/usr/local/bin/mysql --host=$DWH_MYSQL_HOST --user=$DWH_MYSQL_USER --password=$DWH_MYSQL_PASSWD $DWH_MYSQL_DB -rs -e "select CONCAT(\"order_date\",',',\"order_number\",',',\"item_id\",',',\"status\",',',\"quantity\",',',\"payment_method\",',',\"payment_gateway\",',',\"order_category\",',',\"item_sale_price_kwd\",',',\"item_sale_price\",',',\"exchange_rate\",',',\"order_currency\",',',\"item_shipping_charge_kwd\",',',\"item_shipping_charge\",',',\"sku\",',',\"category1\",',',\"category2\",',',\"brand\",',',\"shipped_date\",',',\"delivery_date\",',',\"awbno\")row UNION  select CONCAT('\"',IFNULL(order_date,''),'\",\"',IFNULL(order_number,''),'\",\"',IFNULL(item_id,''),'\",\"',IFNULL(order_status,''),'\",',IFNULL(quantity,''),',\"',IFNULL(payment_method,''),'\",\"',IFNULL(payment_gateway,''),'\",\"',IFNULL(order_category,''),'\",',IFNULL(net_sale_price_kwd,''),',',IFNULL(net_sale_price,''),',',IFNULL(exchange_rate,''),',\"',IFNULL(order_currency,''),'\",',IFNULL(shipping_charge_kwd,''),',',IFNULL(shipping_charge,''),',\"',IFNULL(sku,''),'\",\"',IFNULL(REPLACE(category1,',',''),''),'\",\"',IFNULL(REPLACE(category2,',',''),''),'\",\"',IFNULL(REPLACE(brand,',',''),''),'\",\"',IFNULL(DATE(shipped_at),''),'\",\"',IFNULL(DATE(delivered_at),''),'\",\"',IFNULL(awbno,''),'\"') from (select * from aoi.order_details where order_date between '2019-05-01' and '2019-05-31' order by order_date, order_number) e group by item_id;" > /var/datadumps/finance/ofs_order_dump_201905.csv
/usr/local/bin/mysql --host=$DWH_MYSQL_HOST --user=$DWH_MYSQL_USER --password=$DWH_MYSQL_PASSWD $DWH_MYSQL_DB -rs -e "select CONCAT(\"order_date\",',',\"order_number\",',',\"item_id\",',',\"status\",',',\"quantity\",',',\"payment_method\",',',\"payment_gateway\",',',\"order_category\",',',\"item_sale_price_kwd\",',',\"item_sale_price\",',',\"exchange_rate\",',',\"order_currency\",',',\"item_shipping_charge_kwd\",',',\"item_shipping_charge\",',',\"sku\",',',\"category1\",',',\"category2\",',',\"brand\",',',\"shipped_date\",',',\"delivery_date\",',',\"awbno\")row UNION  select CONCAT('\"',IFNULL(order_date,''),'\",\"',IFNULL(order_number,''),'\",\"',IFNULL(item_id,''),'\",\"',IFNULL(order_status,''),'\",',IFNULL(quantity,''),',\"',IFNULL(payment_method,''),'\",\"',IFNULL(payment_gateway,''),'\",\"',IFNULL(order_category,''),'\",',IFNULL(net_sale_price_kwd,''),',',IFNULL(net_sale_price,''),',',IFNULL(exchange_rate,''),',\"',IFNULL(order_currency,''),'\",',IFNULL(shipping_charge_kwd,''),',',IFNULL(shipping_charge,''),',\"',IFNULL(sku,''),'\",\"',IFNULL(REPLACE(category1,',',''),''),'\",\"',IFNULL(REPLACE(category2,',',''),''),'\",\"',IFNULL(REPLACE(brand,',',''),''),'\",\"',IFNULL(DATE(shipped_at),''),'\",\"',IFNULL(DATE(delivered_at),''),'\",\"',IFNULL(awbno,''),'\"') from (select * from aoi.order_details where order_date between '2019-06-01' and '2019-06-30' order by order_date, order_number) e group by item_id;" > /var/datadumps/finance/ofs_order_dump_201906.csv
/usr/local/bin/mysql --host=$DWH_MYSQL_HOST --user=$DWH_MYSQL_USER --password=$DWH_MYSQL_PASSWD $DWH_MYSQL_DB -rs -e "select CONCAT(\"order_date\",',',\"order_number\",',',\"item_id\",',',\"status\",',',\"quantity\",',',\"payment_method\",',',\"payment_gateway\",',',\"order_category\",',',\"item_sale_price_kwd\",',',\"item_sale_price\",',',\"exchange_rate\",',',\"order_currency\",',',\"item_shipping_charge_kwd\",',',\"item_shipping_charge\",',',\"sku\",',',\"category1\",',',\"category2\",',',\"brand\",',',\"shipped_date\",',',\"delivery_date\",',',\"awbno\")row UNION  select CONCAT('\"',IFNULL(order_date,''),'\",\"',IFNULL(order_number,''),'\",\"',IFNULL(item_id,''),'\",\"',IFNULL(order_status,''),'\",',IFNULL(quantity,''),',\"',IFNULL(payment_method,''),'\",\"',IFNULL(payment_gateway,''),'\",\"',IFNULL(order_category,''),'\",',IFNULL(net_sale_price_kwd,''),',',IFNULL(net_sale_price,''),',',IFNULL(exchange_rate,''),',\"',IFNULL(order_currency,''),'\",',IFNULL(shipping_charge_kwd,''),',',IFNULL(shipping_charge,''),',\"',IFNULL(sku,''),'\",\"',IFNULL(REPLACE(category1,',',''),''),'\",\"',IFNULL(REPLACE(category2,',',''),''),'\",\"',IFNULL(REPLACE(brand,',',''),''),'\",\"',IFNULL(DATE(shipped_at),''),'\",\"',IFNULL(DATE(delivered_at),''),'\",\"',IFNULL(awbno,''),'\"') from (select * from aoi.order_details where order_date between '2019-07-01' and '2019-07-31' order by order_date, order_number) e group by item_id;" > /var/datadumps/finance/ofs_order_dump_201907.csv
cd /var/datadumps/finance; zip -P 'securepass1' ofs_order_dump_201903.csv.zip ofs_order_dump_201903.csv; zip -P 'securepass1' ofs_order_dump_201904.csv.zip ofs_order_dump_201904.csv; zip -P 'securepass1' ofs_order_dump_201905.csv.zip ofs_order_dump_201905.csv; zip -P 'securepass1' ofs_order_dump_201906.csv.zip ofs_order_dump_201906.csv; zip -P 'securepass1' ofs_order_dump_201907.csv.zip ofs_order_dump_201907.csv; rm ofs_order_dump*.csv ; aws s3 sync . s3://btqbi/datadumps/finance/ --acl public-read
