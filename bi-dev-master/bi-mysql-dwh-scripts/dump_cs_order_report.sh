/usr/local/bin/mysql --host=$DWH_MYSQL_HOST --user=$DWH_MYSQL_USER --password=$DWH_MYSQL_PASSWD $DWH_MYSQL_DB -rs -e "select CONCAT(\"order_number\",',',\"sku\",',',\"order_date\",',',\"confirm_date\",',',\"order_type\",',',\"order_category\",',',\"order_status\",',',\"warehouse_status\",',',\"billing_phone_no\",',',\"shipping_phone_no\",',',\"order_currency\",',',\"payment_method\",',',\"payment_gateway\",',',\"quantity\")row UNION select CONCAT(IFNULL(order_number,''),',\"',IFNULL(sku,''),'\",\"',IFNULL(order_date,''),'\",\"',IFNULL(DATE(confirmed_at),''),'\",\"',IFNULL(order_type,''),'\",\"',IFNULL(order_type,''),'\",\"',IFNULL(order_category,''),'\",\"',IFNULL(order_status,''),'\",\"',IFNULL(REPLACE(status_grouped_ops, LEFT(status_grouped_ops,4),''),''),'\",\"',IFNULL(billing_phone_no,''),'\",\"',IFNULL(shipping_phone_no,''),'\",\"',IFNULL(order_currency,''),'\",\"',IFNULL(payment_method,''),'\",\"',IFNULL(payment_gateway,''),'\",',IFNULL(count(1),'')) from (select * from aoi.order_details where order_date = DATE(CONVERT_TZ(NOW(),'+00:00','+03:00') - INTERVAL 1 DAY) order by order_date, order_number) e group by item_id;" > /var/datadumps/cs/ofs_order_dump_yesterday.csv
cd /var/datadumps/cs; zip -P 'securepass1' ofs_order_dump_yesterday.csv.zip ofs_order_dump_yesterday.csv; rm ofs_order_dump_yesterday.csv ; aws s3 sync . s3://btqbi/datadumps/cs/ --acl public-read


