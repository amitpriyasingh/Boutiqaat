#create product_agg Table

CREATE TABLE `product_agg` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `sku_id` varchar(30) DEFAULT NULL,
  `sku_name` char(255) DEFAULT NULL,
  `sku_barcode` char(50) DEFAULT NULL,
  `sku_category1` decimal(22,0) DEFAULT NULL,
  `sku_category2` decimal(22,0) DEFAULT NULL,
  `sku_category3` decimal(22,0) DEFAULT NULL,
  `sku_category4` decimal(22,0) DEFAULT NULL,
  `unit_id` decimal(22,0) DEFAULT NULL,
  `sales_price` decimal(20,6) DEFAULT NULL,
  `is_active` char(1) DEFAULT NULL,
  `sku_type` decimal(1,0) DEFAULT NULL,
  `last_order_date` date DEFAULT NULL,
  `last_order_cost` decimal(20,7) DEFAULT NULL,
  `hold_qty` decimal(15,0) DEFAULT NULL,
  `created_date` date DEFAULT NULL,
  `updated_date` date DEFAULT NULL,
  `brand_id` decimal(5,0) DEFAULT NULL,
  `last_purchase_date` date DEFAULT NULL,
  `last_purchase_cost` decimal(20,7) DEFAULT NULL,
  `supplier_id` decimal(15,0) DEFAULT NULL,
  `first_grn_date` date DEFAULT NULL,
  `last_grn_date` date DEFAULT NULL,
  `hasexpirydate` date DEFAULT NULL,
  `box_qty` decimal(7,0) DEFAULT NULL,
  `box_hold_bill_no` decimal(9,0) DEFAULT NULL,
  `box_prod_bill_no` decimal(9,0) DEFAULT NULL,
  `box_discount` decimal(8,3) DEFAULT NULL,
  `box_status` decimal(1,0) DEFAULT NULL,
  `special_price` decimal(20,6) DEFAULT NULL,
  `celibrity_id` decimal(16,0) DEFAULT NULL,
  `sales_unit_id` decimal(22,0) DEFAULT NULL,
  `purchase_unit_id` decimal(22,0) DEFAULT NULL,
  `location_code` char(50) DEFAULT NULL,
  `supplier_name` char(150) DEFAULT NULL,
  `supplier_address` char(200) DEFAULT NULL,
  `supplier_telephone1` char(100) DEFAULT NULL,
  `supplier_contact` char(100) DEFAULT NULL,
  `supplier_account_no` decimal(16,0) DEFAULT NULL,
  `supplier_email` char(100) DEFAULT NULL,
  `supplier_op_balance` decimal(16,0) DEFAULT NULL,
  `supplier_balance` decimal(10,0) DEFAULT NULL,
  `brand_name` varchar(100) DEFAULT NULL,
  `magento_id` decimal(11,0) DEFAULT NULL,
  `warehouse_no` decimal(22,0) DEFAULT NULL,
  `qty` float DEFAULT NULL,
  `qty1` float DEFAULT NULL,
  `location` char(120) DEFAULT NULL,
  `qty2` float DEFAULT NULL,
  `first_qty` decimal(20,3) DEFAULT NULL,
  `first_avr` decimal(20,6) DEFAULT NULL,
  `item_cost` decimal(20,6) DEFAULT NULL,
  `total_sold` decimal(15,6) DEFAULT NULL,
  `last_sold_date` date DEFAULT NULL,
  `deliv_qty_temp` decimal(15,0) DEFAULT NULL,
  `temp1` decimal(20,3) DEFAULT NULL,
  `temp2` decimal(20,3) DEFAULT NULL,
  `temp3` decimal(20,3) DEFAULT NULL,
  `temp4` decimal(20,3) DEFAULT NULL,
  `temp_balance` decimal(20,3) DEFAULT NULL,
  `product_unit` decimal(20,6) DEFAULT NULL,
  `conv` decimal(10,3) DEFAULT NULL,
  `stok_date_qty` decimal(15,0) DEFAULT NULL,
  `stock_date_qty1` decimal(15,0) DEFAULT NULL,
  `stock_date_qty2` decimal(15,0) DEFAULT NULL,
  `avr_on` decimal(1,0) DEFAULT NULL,
  `first_qty_valid_payed` decimal(20,3) DEFAULT NULL,
  `first_qty_valid_notpayed` decimal(20,3) DEFAULT NULL,
  `first_qty_notvalid_payed` decimal(20,3) DEFAULT NULL,
  `first_qty_notvalid_notpayed` decimal(20,3) DEFAULT NULL,
  `qty_valid_payed` decimal(20,3) DEFAULT NULL,
  `qty_valid_notpayed` decimal(20,3) DEFAULT NULL,
  `qty_notvalid_payed` decimal(20,3) DEFAULT NULL,
  `qty_notvalid_notpayed` decimal(20,3) DEFAULT NULL,
  `stock_date_cost` decimal(20,6) DEFAULT NULL,
  `unit_cd` decimal(5,0) DEFAULT NULL,
  `temp_qty` decimal(15,0) DEFAULT NULL,
  `first_temp_qty` decimal(15,0) DEFAULT NULL,
  `act_temp_qty` decimal(15,0) DEFAULT NULL,
  `celebrity_name_e` char(50) DEFAULT NULL,
  `celebrity_name_a` char(50) DEFAULT NULL,
  `celebrity_st` decimal(16,0) DEFAULT NULL,
  `celebrity_account_no` decimal(16,0) DEFAULT NULL,
  `celebrity_acc_id` decimal(16,0) DEFAULT NULL,
  `celebrity_address` char(200) DEFAULT NULL,
  `celebrity_code` char(20) DEFAULT NULL,
  `celebrity_inter_sw` decimal(1,0) DEFAULT NULL,
  `celebrity_short_name` char(30) DEFAULT NULL,
  `celebrity_old_short_name` char(30) DEFAULT NULL,
  `celebrity_cat1` decimal(1,0) DEFAULT NULL,
  `celebrity_cat2` decimal(1,0) DEFAULT NULL,
  `celebrity_cat3` decimal(1,0) DEFAULT NULL,
  `celebrity_cat4` decimal(1,0) DEFAULT NULL,
  `celebrity_cat5` decimal(1,0) DEFAULT NULL,
  `celebrity_cat6` decimal(1,0) DEFAULT NULL,
  `celebrity_cat7` decimal(1,0) DEFAULT NULL,
  `celebrity_cat8` decimal(1,0) DEFAULT NULL,
  `celebrity_cat9` decimal(1,0) DEFAULT NULL,
  `celebrity_cat10` decimal(1,0) DEFAULT NULL,
  `celebrity_cat11` decimal(1,0) DEFAULT NULL,
  `celebrity_cat12` decimal(1,0) DEFAULT NULL,
  `celebrity_cat13` decimal(1,0) DEFAULT NULL,
  `celebrity_cat14` decimal(1,0) DEFAULT NULL,
  `celebrity_cat15` decimal(1,0) DEFAULT NULL,
  `celebrity_cat16` decimal(1,0) DEFAULT NULL,
  `celebrity_cat17` decimal(1,0) DEFAULT NULL,
  `celebrity_cat18` decimal(1,0) DEFAULT NULL,
  `celebrity_cat19` decimal(1,0) DEFAULT NULL,
  `celebrity_cat20` decimal(1,0) DEFAULT NULL,
  `category1` varchar(20) DEFAULT NULL,
  `category2` varchar(20) DEFAULT NULL,
  `category3` varchar(20) DEFAULT NULL,
  `category4` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`id`)
)





#first time insertion of existing data# Please update the table.

INSERT INTO product_agg
            (sku_id,
            sku_name,
            sku_barcode,
            sku_category1,
            sku_category2,
            sku_category3,
            sku_category4,
            unit_id,
            sales_price,
            is_active,
            sku_type,
            last_order_date,
            last_order_cost,
            hold_qty,
            created_date,
            updated_date,
            brand_id,
            last_purchase_date,
            last_purchase_cost,
            supplier_id,
            first_grn_date,
            last_grn_date,
            hasexpirydate,
            box_qty,
            box_hold_bill_no,
            box_prod_bill_no,
            box_discount,
            box_status,
            special_price,
            celibrity_id,
            sales_unit_id,
            purchase_unit_id,
            location_code,
            supplier_name,
            supplier_address,
            supplier_telephone1,
            supplier_contact,
            supplier_account_no,
            supplier_email,
            supplier_op_balance,
            supplier_balance,
            brand_name,
            magento_id,
            warehouse_no,
            qty,
            qty1,
            location,
            qty2,
            first_qty,
            first_avr,
            item_cost,
            total_sold,
            last_sold_date,
            deliv_qty_temp,
            temp1,
            temp2,
            temp3,
            temp4,
            temp_balance,
            product_unit,
            conv,
            stok_date_qty,
            stock_date_qty1,
            stock_date_qty2,
            avr_on,
            first_qty_valid_payed,
            first_qty_valid_notpayed,
            first_qty_notvalid_payed,
            first_qty_notvalid_notpayed,
            qty_valid_payed,
            qty_valid_notpayed,
            qty_notvalid_payed,
            qty_notvalid_notpayed,
            stock_date_cost,
            unit_cd,
            temp_qty,
            first_temp_qty,
            act_temp_qty,
            celebrity_name_e,
            celebrity_name_a,
            celebrity_st,
            celebrity_account_no,
            celebrity_acc_id,
            celebrity_address,
            celebrity_code,
            celebrity_inter_sw,
            celebrity_short_name,
            celebrity_old_short_name,
            celebrity_cat1,
            celebrity_cat2,
            celebrity_cat3,
            celebrity_cat4,
            celebrity_cat5,
            celebrity_cat6,
            celebrity_cat7,
            celebrity_cat8,
            celebrity_cat9,
            celebrity_cat10,
            celebrity_cat11,
            celebrity_cat12,
            celebrity_cat13,
            celebrity_cat14,
            celebrity_cat15,
            celebrity_cat16,
            celebrity_cat17,
            celebrity_cat18,
            celebrity_cat19,
            celebrity_cat20)




SELECT 
    ep.id,
    ep.name,
    ep.barcode,
    ep.cat1,
    ep.cat2,
    ep.cat3,
    ep.cat4,
    ep.unitid,
    ep.salesprice,
    ep.isactive,
    ep.skutype,
    ep.lastorderdate,
    ep.lastorderprice,
    ep.holdqty,
    ep.createdate,
    ep.updatedate,
    ep.brandid,
    ep.lastpurchasedate,
    ep.lastpurchaseprice,
    ep.supplierid,
    ep.firstgrndate,
    ep.lastgrndate,
    ep.hasexpirydate,
    ep.boxqty,
    ep.boxholdbillno,
    ep.boxprodbillno,
    ep.boxdiscount,
    ep.boxstatus,
    ep.specialprice,
    ep.celebrityid,
    ep.salesunitid,
    ep.purchaseunitid,
    ep.locationcode,

    ep.suppliername,
    ep.supplieraddress,
    ep.suppliertel1,
    ep.suppliercontact,
    ep.supplieraccountno,
    ep.supplieremail,
    ep.supplieropbalance,
    ep.supplierbalance,

    ep.brandname,
    ep.magentoid,

    PRODS,
    QTY,
    QTY1,
    LOCATION,
    QTY2,
    FIRST_QTY,
    FIRST_AVR,
    COST,
    TOTAL_SOLD,
    LAST_SOLD_DATE,
    DELIV_QTY_TEMP,
    TEMP1,
    TEMP2,
    TEMP3,
    TEMP4,
    TEMP_BALANCE,
    PRODS_UNIT,
    CONV,
    STOCK_DATE_QTY,
    STOCK_DATE_QTY1,
    STOCK_DATE_QTY2,
    AVR_ON,
    FIRST_QTY_VALID_PAYED,
    FIRST_QTY_VALID_NOTPAYED,
    FIRST_QTY_NOTVALID_PAYED,
    FIRST_QTY_NOTVALID_NOTPAYED,
    QTY_VALID_PAYED,
    QTY_VALID_NOTPAYED,
    QTY_NOTVALID_PAYED,
    QTY_NOTVALID_NOTPAYED,
    STOCK_DATE_COST,
    UNIT_CD,
    TEMP_QTY,
    FIRST_TEMP_QTY,
    ACT_TEMP_QTY,

    ep.celebrityname,
    ep.celebritynamea,
    ep.st,
    ep.celebrityaccountid,
    ep.celebrityaccid,
    ep.celebrityaddress,
    ep.celebritycode,
    ep.celebrityintersw,
    ep.shortname,
    ep.oldname,
    ep.ccat1,
    ep.ccat2,
    ep.ccat3,
    ep.ccat4,
    ep.ccat5,
    ep.ccat6,
    ep.ccat7,
    ep.ccat8,
    ep.ccat9,
    ep.ccat10,
    ep.ccat11,
    ep.ccat12,
    ep.ccat13,
    ep.ccat14,
    ep.ccat15,
    ep.ccat16,
    ep.ccat17,
    ep.ccat18,
    ep.ccat19,
    ep.ccat20
        
    FROM
        ERP_ITEM_PRODS eip 
    LEFT JOIN   

    (SELECT

        esk.ID                  id,
        esk.SKU_NAME             name,
        esk.SKU_PARCODE          barcode,         
        c1.NAME                 cat1,    
        c2.NAME         cat2,    
        c3.NAME         cat3,    
        c4.NAME          cat4,    
        esk.UNIT_ID                unitid,          
        esk.SALES_PRICE           salesprice,
        esk.IS_ACTIVE              isactive,       
        esk.SKU_TYPE               skutype,         
        esk.LAST_ORDER_DATE        lastorderdate,  
        esk.LAST_ORDER_PRICE        lastorderprice, 
        esk.HOLD_QTY                 holdqty, 
        esk.ADD_DATE                 createdate,         
        esk.UPDATE_DATE               updatedate, 
        esk.BRAND_ID                  brandid,  
        esk.LAST_PURCHASE_DATE        lastpurchasedate,              
        esk.LAST_PURCHASE_PRICE      lastpurchaseprice,             
        esk.SUPPLIER_ID              supplierid, 
        esk.FIRST_GRN_DATE          firstgrndate,   
        esk.LAST_GRN_DATE            lastgrndate,             
        esk.HASEXPIARYDATE            hasexpirydate, 
        esk.BOX_QTY                    boxqty,          
        esk.BOX_HOLD_BILNO             boxholdbillno,   
        esk.BOX_PROD_BILNO            boxprodbillno,   
        esk.BOX_DISCOUNT              boxdiscount, 
        esk.BOX_STATUS                boxstatus,  
        esk.SPECIAL_PRICE              specialprice, 
        esk.CELEBRITY_ID              celebrityid, 
        esk.SALES_UNIT_ID             salesunitid,    
        esk.PURCHASE_UNIT_ID          purchaseunitid,  
        esk.LOCATION_CODE              locationcode,

        esp.NAME                      suppliername,
        esp.ADDRESS                    supplieraddress,
        esp.TEL1                        suppliertel1,
        esp.CONTACT                       suppliercontact,
        esp.ACCOUNT_NO                   supplieraccountno,
        esp.EMAIL                          supplieremail,
        esp.OP_BALANCE                     supplieropbalance,
        esp.BALANCE                           supplierbalance,

        esb.NAME                           brandname,
        esb.MAGENTO_ID                      magentoid, 

        ec.NAME_E                           celebrityname,
        ec.NAME_A                            celebritynamea,
        ec.ST                                st,
        ec.ACCOUNT_ID                        celebrityaccountid,
        ec.ACC_ID                            celebrityaccid,
        ec.CELEB_ADDRESS                     celebrityaddress,
        ec.CELEB_CODE                        celebritycode,
        ec.INTER_SW                           celebrityintersw,
        ec.SHORT_NAME                           shortname,
        ec.OLD_SHORT_NAME                       oldname,
        ec.CAT1                                   ccat1,
        ec.CAT2                          ccat2,
        ec.CAT3                          ccat3,
        ec.CAT4                            ccat4,
        ec.CAT5                          ccat5,
        ec.CAT6                            ccat6,
        ec.CAT7                          ccat7,
        ec.CAT8                           ccat8,
        ec.CAT9                           ccat9,
        ec.CAT10                            ccat10,
        ec.CAT11                          ccat11,
        ec.CAT12                          ccat12,
        ec.CAT13                          ccat13,
        ec.CAT14                           ccat14,
        ec.CAT15                           ccat15,
        ec.CAT16                            ccat16,
        ec.CAT17                           ccat17,
        ec.CAT18                           ccat18,
        ec.CAT19                         ccat19,
        ec.CAT20                         ccat20

        FROM ERP_SKUs esk
        LEFT JOIN ERP_SUPPLIERS esp ON esk.SUPPLIER_ID = esp.ID
        LEFT JOIN ERP_SKU_BRANDS esb ON esb.ID = esk.BRAND_ID
        LEFT JOIN ERP_CELEBERITY ec ON ec.ID = esk.CELEBRITY_ID
        LEFT JOIN ERP_SKU_CATEGORY1 c1 on c1.ID = esk.SKU_CATEGORY1
        LEFT JOIN ERP_SKU_CATEGORY2 c2 on c2.ID = esk.SKU_CATEGORY2
        LEFT JOIN ERP_SKU_CATEGORY3 c3 on c3.ID = esk.SKU_CATEGORY3
        LEFT JOIN ERP_SKU_CATEGORY4 c4 on c4.ID = esk.SKU_CATEGORY4) ep ON ep.id = eip.PRODN 
        ;
